process DQMforTracksMonitoring = {

  #=========================================================================================
  # MessageLogger
    service = MessageLogger {
      untracked vstring suppressInfo = {"siStripClusters","siStripClusters325"}

      untracked vstring destinations =
      {
	"cout", "cerr"
      }
      untracked vstring categories =
      {
	"FwkJob",
	"FwkReport",
	"Root_NoDictionary"
      }
      untracked PSet cout =
      {
	untracked string threshold = "INFO"
	untracked PSet default =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1
	}
	untracked PSet FwkJob =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
	untracked PSet FwkReport =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
      }
      untracked PSet cerr = { untracked string threshold = "ERROR" }
    }  
  # End MessageLogger
  #=========================================================================================

  #=========================================================================================
  # Sources
        source = PoolSource { 
          	untracked vstring fileNames = {
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.0.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.1.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.2.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.3.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.4.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.5.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.6.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.7.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.8.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.9.root',
        'rfio:/castor/cern.ch/cms/store/TAC/TIBTOB/edm_2007_03_07/tif.00006215.A.testStorageManager_0.10.root'
      }
   }
  untracked PSet maxEvents = {untracked int32 input = -1}

  # End Sources
  #=========================================================================================
  
  #=========================================================================================
  # Modules Configuration
    # > Magnetic Field <
      include "MagneticField/Engine/data/uniformMagneticField.cfi"
      replace UniformMagneticFieldESProducer.ZFieldInTesla = 0
      es_prefer = UniformMagneticFieldESProducer{}

    # > Geometry <
      include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
      include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

      include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

    #-------------------------------------------------
    ## CALIBRATION (cabling, pedestal....)
    #-------------------------------------------------

    include "CalibTracker/Configuration/data/Tracker_FrontierConditions_TIF.cff"
    #include "CalibTracker/Configuration/data/Tracker_OrconConditions_TIF.cff"

    # > Digitization <
      # SiStripRaw2digi
      include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"

      # ZeroSuppressor
      include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

    # > Clusterization <
      # SiStripClusterizer
      include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
      replace siStripClusters.ChannelThreshold    = 3.0
      replace siStripClusters.SeedThreshold       = 4.0
      replace siStripClusters.ClusterThreshold    = 7.0

    # > DQM <
      # Trigger
      module trigger = MTCCHLTrigger {
	bool    SelOnDigiCharge = false
        # threshold must be larger for collisions (23000 or so for 156 modules selected)
	int32   ChargeThreshold = 180 
	string  ClusterProducer = "siStripClusters"
      }

      # prescaler module
      module Prescaler = Prescaler{ 
	int32 prescaleFactor = 1
      }

      # SiStripMonitorDigi
      include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      # replace SiStripMonitorDigi.SelectAllDetectors = true
      replace SiStripMonitorDigi.SelectAllDetectors  = true
      replace SiStripMonitorDigi.DigiProducersList = {
             { 
	       string DigiProducer = "SiStripDigis"
               string DigiLabel    = "ZeroSuppressed"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "VirginRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ProcessedRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ScopeMode"
             }
      }

      # SiStripMonitorCluster
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      replace SiStripMonitorCluster.SelectAllDetectors  = true
      replace SiStripMonitorCluster.UseCalibDataFromDB  = false # this is for the noise service
      replace SiStripMonitorCluster.OutputMEsInRootFile = false

      # Trigger Monitoring, SiStripMonitorHLT
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"


      # DQM services
     include "DQMServices/Core/data/DQM.cfg"





  #################TRACK RECONSTRUCTION###################

  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
   
  include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
  #stripCPE
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
  #pixelCPE
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
  #TransientTrackingBuilder
  include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
  #MeasurementTracker
  include "RecoTracker/MeasurementDet/data/MeasurementTrackerESProducer.cfi"
  #replace MeasurementTrackerESProducer.pixelClusterProducer = ""
  es_prefer = MeasurementTrackerESProducer {}
  include "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cfi"

  ### Cosmic Track Finder ###
  module cosmicseedfinder= CosmicSeedGenerator{
    InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
    InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
    InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
    double ptMin=0.9
    double originRadius=150
    double originHalfLength=90
    double originZPosition=0
    string TTRHBuilder        =  "WithTrackAngle"
    untracked string GeometricStructure  = "STANDARD" //other choice: TIBD+
  }
 
  module cosmictrackfinder= CosmicTrackFinder{
    bool TrajInEvents=true
    InputTag cosmicSeeds = cosmicseedfinder:
    InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
    InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
    InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
    string HitProducer        = "siStripRecHits"
    int32 MinHits=4
    double Chi2Cut=100.
    string TTRHBuilder    =   "WithTrackAngle"
    untracked string GeometricStructure  = "MTCC"
  }

  ### Combinatorial Seed Generator For Cosmics

    module combinatorialcosmicseedfinder= CombinatorialSeedGeneratorForCosmics{
	InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
	InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
	InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit 
	double SeedMomentum = 1   #initial momentum in GeV 	
	untracked string GeometricStructure  = "CkfTIF3"  //other options: Standard,CkfTIBD+, TOB: CkfTIF3
	string Matcher = "StandardMatcher"
	PSet UpperScintillatorParameters = {
	    double WidthInX = 100
	    double LenghtInZ = 100
	    double GlobalX = 0
	    double GlobalY = 300
	    double GlobalZ = 50
	}
	PSet LowerScintillatorParameters = {
	    double WidthInX = 100
	    double LenghtInZ = 100
	    double GlobalX = 0
	    double GlobalY = -150
	    double GlobalZ = 50
	}		
    }




  ### Road Search ###
  # KFTrajectoryFitterESProducer
  include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
  # KFTrajectorySmootherESProducer
  include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
  # KFFittingSmootherESProducer 
  include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"
  #KFUpdatoerESProducer
  include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
  # Chi2MeasurementEstimatorESProducer
  include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"
 
  #KFUpdatoerESProducer
  include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
  #PropagatorWithMaterialESProducer
  include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"
  #PropagatorWithMaterialESProducer
  include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
 
  include "RecoTracker/RoadMapESSource/data/RoadMapESSourceTIFTOB.cff"
  include "RecoTracker/RoadSearchSeedFinder/data/RoadSearchSeedsTIFTOB.cff"
  include "RecoTracker/RoadSearchCloudMaker/data/RawRoadSearchCloudsTIFTOB.cff"
  include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidatesTIFTOB.cff"
 

  include "RecoTracker/TrackProducer/data/RSFinalFitWithMaterial.cff"


  ### Cosmic Track Finder ###
  # CTF analytical track fit
  ##include "RecoTracker/TrackProducer/data/CTFFinalFitAnalytical.cff" # deprecated, B.Mangano
    

  # GlobalMixedSeedGenerator
#  include "RecoTracker/TkSeedGenerator/data/GlobalMixedSeeds.cff"
    
  # KFTrackCandidateMaker
  include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
  replace ckfTrackCandidates.TrajectoryBuilder    = "GroupedCkfTrajectoryBuilder"
  replace ckfTrackCandidates.SeedProducer         = "combinatorialcosmicseedfinder"
  replace ckfBaseTrajectoryFilter.filterPset.minPt               = 0.01
  replace ckfBaseTrajectoryFilter.filterPset.maxLostHits         = 3
  replace ckfBaseTrajectoryFilter.filterPset.maxConsecLostHits   = 1
  replace ckfBaseTrajectoryFilter.filterPset.minimumNumberOfHits = 4

  include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
 

    # MonitorTrackResiduals
    include "DQM/TrackerMonitorTrack/data/MonitorTrackResiduals.cfi"
    #replace MonitorTrackResiduals.TrackCandidateProducer = "ckfTrackCandidates"
    replace MonitorTrackResiduals.TrackCandidateProducer = "ctfWithMaterialTracks"
    replace MonitorTrackResiduals.OutputMEsInRootFile = true
    replace MonitorTrackResiduals.OutputFileName="DQMTracksMonitoring.root"

  # End Modules Configuration
  #=========================================================================================

  #=========================================================================================
  # Schedule
    sequence seqDigitization   = { 
      SiStripDigis,
      siStripZeroSuppression
    }
    sequence seqClusterization = { 
      siStripClusters
    }
    sequence seqDQM            = { 
#      SiStripMonitorDigi,
#      SiStripMonitorCluster,
      MonitorTrackResiduals
    }

    sequence local_reco = {siStripMatchedRecHits}

    sequence seqCosmicTrackFinder = { 
	cosmicseedfinder &
	cosmictrackfinder }

    sequence cominatorial_track_finder = {
       combinatorialcosmicseedfinder,
       ckfTrackCandidates,
       ctfWithMaterialTracks }

    sequence rs_track_finder = { 
        roadSearchSeeds,
        rawRoadSearchClouds,
        rsTrackCandidates,
        rsWithMaterialTracks }

    path pDigisClustersClusterInfos = {
      seqDigitization,
      seqClusterization,
      local_reco,
      cominatorial_track_finder, 
      rs_track_finder,
      seqDQM 
    }

    #endpath e1 = { out}
  # End Schedule
  #=========================================================================================
}
