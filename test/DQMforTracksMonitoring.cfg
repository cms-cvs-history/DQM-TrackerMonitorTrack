process DQMforTracksMonitoring = {

  #=========================================================================================
  # MessageLogger
    service = MessageLogger {
      untracked vstring suppressInfo = {"siStripClusters","siStripClusters325"}

      untracked vstring destinations =
      {
	"cout", "cerr"
      }
      untracked vstring categories =
      {
	"FwkJob",
	"FwkReport",
	"Root_NoDictionary"
      }
      untracked PSet cout =
      {
	untracked string threshold = "INFO"
	untracked PSet default =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1
	}
	untracked PSet FwkJob =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
	untracked PSet FwkReport =
	{
	  untracked int32 limit       = 1000000000
	  untracked int32 reportEvery = 1000
	}
      }
      untracked PSet cerr = { untracked string threshold = "ERROR" }
    }  
  # End MessageLogger
  #=========================================================================================

  #=========================================================================================
  # Sources
    source = TBRUInputSource
    {
	untracked vstring fileNames = {	"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_000.root",
                                        "castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_001.root",
                                        #"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_002.root",
                                        #"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_003.root",
                                        #"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_004.root",
                                        #"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_005.root",
                                        #"castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_006.root",
                                        "castor:/castor/cern.ch/cms/testbeam/TAC/TIBTOB/run/RU0005164_007.root" }
	untracked int32 maxEvents = -1	// number of events to process (-1 = "all")
    }
  # End Sources
  #=========================================================================================
  
  #=========================================================================================
  # Modules Configuration
    # > Magnetic Field <
      include "MagneticField/Engine/data/uniformMagneticField.cfi"
      replace UniformMagneticFieldESProducer.ZFieldInTesla = 0
      es_prefer = UniformMagneticFieldESProducer{}

    # > Geometry <
      include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
      include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

      include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

    # > Cabling and Pedestals <
      # read cabling and pedestals from DB
    es_source = PoolDBESSource { 


       VPSet toGet = {{ string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIBTOB_v1"},
                      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIBTOB_v1_n"},
                      { string record = "SiStripPedestalsRcd" string tag= "SiStripPedNoise_TIBTOB_v1_p"}}
        
        bool loadAll = true
        string connect = "oracle://devdb10/CMS_COND_STRIP"
        string timetype = "runnumber" 
        untracked string BlobStreamerName="DefaultBlobStreamingService"        
	PSet DBParameters = {
	    untracked string authenticationPath ="/afs/cern.ch/cms/DB/conddb"
            untracked int32 messageLevel = 1
	}
      }

      # produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
      es_module sistripconn = SiStripConnectivity {}

    # > Digitization <
      # SiStripRaw2digi
      include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"

      # ZeroSuppressor
      include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"

    # > Clusterization <
      # SiStripClusterizer
      include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
      replace siStripClusters.ChannelThreshold    = 3.0
      replace siStripClusters.SeedThreshold       = 4.0
      replace siStripClusters.ClusterThreshold    = 7.0

    # > DQM <
      # Trigger
      module trigger = MTCCHLTrigger {
	bool    SelOnDigiCharge = false
        # threshold must be larger for collisions (23000 or so for 156 modules selected)
	int32   ChargeThreshold = 180 
	string  ClusterProducer = "siStripClusters"
      }

      # prescaler module
      module Prescaler = Prescaler{ 
	int32 prescaleFactor = 1
      }

      # SiStripMonitorDigi
      include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      # replace SiStripMonitorDigi.SelectAllDetectors = true
      replace SiStripMonitorDigi.SelectAllDetectors  = true
      replace SiStripMonitorDigi.DigiProducersList = {
             { 
	       string DigiProducer = "SiStripDigis"
               string DigiLabel    = "ZeroSuppressed"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "VirginRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ProcessedRaw"
             },
             { 
	       string DigiProducer = "siStripZeroSuppression"
               string DigiLabel    = "ScopeMode"
             }
      }

      # SiStripMonitorCluster
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
      # use the following flag to select all detectors (e.g. for mtcc data). by default is false
      replace SiStripMonitorCluster.SelectAllDetectors  = true
      replace SiStripMonitorCluster.UseCalibDataFromDB  = false # this is for the noise service
      replace SiStripMonitorCluster.OutputMEsInRootFile = false

      # Trigger Monitoring, SiStripMonitorHLT
      include "DQM/SiStripMonitorCluster/data/SiStripMonitorHLT.cfi"


      # DQM services
      service = DaqMonitorROOTBackEnd{}

#      service = DQMShipMonitoring{
      // event-period for shipping monitoring to collector (default: 25)
#       untracked uint32 period = 5
#       }

       # Monitor Daemon to run DQM with source-collector-client
#      include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"
#      replace MonitorDaemon.DestinationAddress = "cmstkmon.cern.ch"
#      replace MonitorDaemon.UpdateDelay = 5000


  #################TRACK RECONSTRUCTION###################

  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
   
  include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
  #stripCPE
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
  #pixelCPE
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
  #TransientTrackingBuilder
  include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
  #MeasurementTracker
  include "RecoTracker/MeasurementDet/data/MeasurementTrackerESProducer.cfi"
  #replace MeasurementTrackerESProducer.pixelClusterProducer = ""
  es_prefer = MeasurementTrackerESProducer {}
  include "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cfi"

  ### Cosmic Track Finder ###
  module cosmicseedfinder= CosmicSeedGenerator{
    InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
    InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
    InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
    double ptMin=0.9
    double originRadius=150
    double originHalfLength=90
    double originZPosition=0
    string TTRHBuilder        =  "WithTrackAngle"
    untracked string GeometricStructure  = "STANDARD" //other choice: TIBD+
  }
 
  module cosmictrackfinder= CosmicTrackFinder{
    bool TrajInEvents=true
    InputTag cosmicSeeds = cosmicseedfinder:
    InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
    InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
    InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit
    string HitProducer        = "siStripRecHits"
    int32 MinHits=4
    double Chi2Cut=100.
    string TTRHBuilder    =   "WithTrackAngle"
    untracked string GeometricStructure  = "MTCC"
  }

  ### Combinatorial Seed Generator For Cosmics

    module combinatorialcosmicseedfinder= CombinatorialSeedGeneratorForCosmics{
	InputTag matchedRecHits = siStripMatchedRecHits:matchedRecHit
	InputTag rphirecHits    = siStripMatchedRecHits:rphiRecHit
	InputTag stereorecHits  = siStripMatchedRecHits:stereoRecHit 
	double SeedMomentum = 1   #initial momentum in GeV 	
	untracked string GeometricStructure  = "CkfTIF3"  //other options: Standard,CkfTIBD+, TOB: CkfTIF3
	string Matcher = "StandardMatcher"
	PSet UpperScintillatorParameters = {
	    double WidthInX = 100
	    double LenghtInZ = 100
	    double GlobalX = 0
	    double GlobalY = 300
	    double GlobalZ = 50
	}
	PSet LowerScintillatorParameters = {
	    double WidthInX = 100
	    double LenghtInZ = 100
	    double GlobalX = 0
	    double GlobalY = -150
	    double GlobalZ = 50
	}		
    }




  ### Road Search ###
  # KFTrajectoryFitterESProducer
  include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
  # KFTrajectorySmootherESProducer
  include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
  # KFFittingSmootherESProducer 
  include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"
  #KFUpdatoerESProducer
  include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
  # Chi2MeasurementEstimatorESProducer
  include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"
 
  #KFUpdatoerESProducer
  include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
  #PropagatorWithMaterialESProducer
  include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"
  #PropagatorWithMaterialESProducer
  include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
 
  include "RecoTracker/RoadMapESSource/data/RoadMapESSourceTIFTOB.cff"
  include "RecoTracker/RoadSearchSeedFinder/data/RoadSearchSeedsTIFTOB.cff"
  include "RecoTracker/RoadSearchCloudMaker/data/RawRoadSearchCloudsTIFTOB.cff"
  include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidatesTIFTOB.cff"
 
  # final track fit with material
  module rsWithMaterialTracks = TrackProducer {
    string Fitter             = "KFFittingSmoother"
    string Propagator         = "PropagatorWithMaterial"
    string src                = "rsTrackCandidates"
    string producer           = ""
    string TTRHBuilder        =  "WithTrackAngle"
    bool TrajectoryInEvent    = false
  }

  ### Cosmic Track Finder ###
  # CTF analytical track fit
  include "RecoTracker/TrackProducer/data/CTFFinalFitAnalytical.cff"
    

  # GlobalMixedSeedGenerator
#  include "RecoTracker/TkSeedGenerator/data/GlobalMixedSeeds.cff"
    
  # KFTrackCandidateMaker
  include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
  replace ckfTrackCandidates.TrajectoryBuilder    = "GroupedCkfTrajectoryBuilder"
  replace ckfTrackCandidates.SeedProducer         = "combinatorialcosmicseedfinder"
  replace GroupedCkfTrajectoryBuilder.ptCut               = 0.01
  replace GroupedCkfTrajectoryBuilder.maxLostHit          = 3
  replace GroupedCkfTrajectoryBuilder.maxConsecLostHit    = 1
  replace GroupedCkfTrajectoryBuilder.minimumNumberOfHits = 4
  replace CkfTrajectoryBuilder.ptCut               = 0.01
  replace CkfTrajectoryBuilder.maxLostHit          = 3
  replace CkfTrajectoryBuilder.maxConsecLostHit    = 1
  replace CkfTrajectoryBuilder.minimumNumberOfHits = 4	

  #final fit
  module ctfWithMaterialTracks = TrackProducer {
    string Fitter = "KFFittingSmoother"
    string Propagator = "PropagatorWithMaterial"
    string src = "ckfTrackCandidates"
    string producer = ""
    string TTRHBuilder       =   "WithTrackAngle"
    bool TrajectoryInEvent = true
  }


 

  ################ MonitorTrackGlobal ################

  module MonitorTrackGlobal = MonitorTrackGlobal
    {
      string TrackProducer="ctfWithMaterialTracks"
      string TrackLabel=""
      string AlgoName="ctf"

      //
      int32 TkSizeBin=500
      double TkSizeMin = 0.0
      double TkSizeMax = 500.0

      int32 RecHitBin=22
      double RecHitMin = 3
      double RecHitMax = 25

      int32 PhiBin = 100
      double PhiMin = -3.2
      double PhiMax = 3.2

      int32 EtaBin = 100
      double EtaMin = -3.0
      double EtaMax = 3.0

      int32 ThetaBin = 100
      double ThetaMin = 0.0
      double ThetaMax = 3.2

      int32 Chi2Bin = 100
      double Chi2Min = -0.5
      double Chi2Max = 500

      int32 TrackPtBin = 20
      double TrackPtMin = -0.5
      double TrackPtMax = 19.5

      int32 TrackPxBin = 100
      double TrackPxMin = -50.0
      double TrackPxMax = 50.0

      int32 TrackPyBin = 100
      double TrackPyMin = -50.0
      double TrackPyMax = 50.0

      int32 TrackPzBin = 100
      double TrackPzMin = -50.0
      double TrackPzMax = 50.0

      //
      bool MTCCData = false
      bool OutputMEsInRootFile = false
      string OutputFileName="test_monitortrackparameters.root"
    }

  module MonitorTrackGlobal2 = MonitorTrackGlobal
    {
      string TrackProducer="rsWithMaterialTracks"
      string TrackLabel=""
      string AlgoName="rs"

      //
      int32 TkSizeBin=500
      double TkSizeMin = 0.0
      double TkSizeMax = 500.0

      int32 RecHitBin=22
      double RecHitMin = 3
      double RecHitMax = 25

      int32 PhiBin = 100
      double PhiMin = -3.2
      double PhiMax = 3.2

      int32 EtaBin = 100
      double EtaMin = -3.0
      double EtaMax = 3.0

      int32 ThetaBin = 100
      double ThetaMin = 0.0
      double ThetaMax = 3.2

      int32 Chi2Bin = 100
      double Chi2Min = -0.5
      double Chi2Max = 500

      int32 TrackPtBin = 20
      double TrackPtMin = -0.5
      double TrackPtMax = 19.5

      int32 TrackPxBin = 100
      double TrackPxMin = -50.0
      double TrackPxMax = 50.0

      int32 TrackPyBin = 100
      double TrackPyMin = -50.0
      double TrackPyMax = 50.0

      int32 TrackPzBin = 100
      double TrackPzMin = -50.0
      double TrackPzMax = 50.0

      //
      bool MTCCData = false
      bool OutputMEsInRootFile = false
      string OutputFileName="test_monitortrackparameters.root"
    }


    # MonitorTrackGlobal
    #include "DQM/TrackerMonitorTrack/data/MonitorTrackGlobal.cfi"
    #replace MonitorTrackGlobal.TrackProducer = "rsWithMaterialTracks"
    #replace MonitorTrackGlobal.TrackProducer = "ctfWithMaterialTracks"


    # MonitorTrackResiduals
    include "DQM/TrackerMonitorTrack/data/MonitorTrackResiduals.cfi"
    #replace MonitorTrackResiduals.TrackCandidateProducer = "ckfTrackCandidates"
    replace MonitorTrackResiduals.TrackCandidateProducer = "ctfWithMaterialTracks"
    replace MonitorTrackResiduals.OutputMEsInRootFile = true
    replace MonitorTrackResiduals.OutputFileName="DQMTracksMonitoring.root"

  # End Modules Configuration
  #=========================================================================================

  #=========================================================================================
  # Schedule
    sequence seqDigitization   = { 
      SiStripDigis,
      siStripZeroSuppression
    }
    sequence seqClusterization = { 
      siStripClusters
    }
    sequence seqDQM            = { 
#      SiStripMonitorDigi,
#      SiStripMonitorCluster,
      MonitorTrackGlobal,
      MonitorTrackGlobal2,
      MonitorTrackResiduals
    }

    sequence local_reco = {siStripMatchedRecHits}

    sequence seqCosmicTrackFinder = { 
	cosmicseedfinder &
	cosmictrackfinder }

    sequence cominatorial_track_finder = {
       combinatorialcosmicseedfinder,
       ckfTrackCandidates,
       ctfWithMaterialTracks }

    sequence rs_track_finder = { 
        roadSearchSeeds,
        rawRoadSearchClouds,
        rsTrackCandidates,
        rsWithMaterialTracks }

    path pDigisClustersClusterInfos = {
      seqDigitization,
      seqClusterization,
      local_reco,
      cominatorial_track_finder, 
      rs_track_finder,
      seqDQM 
    }

    #endpath e1 = { out}
  # End Schedule
  #=========================================================================================
}
